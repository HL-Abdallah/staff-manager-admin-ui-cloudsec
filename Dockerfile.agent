FROM jenkins/agent:latest

USER root

# Install stuff needed for 
RUN apt-get update && \
    apt-get install -y docker awscli default-jdk && \
    rm -rf /var/lib/apt/lists/*

# install npm & node
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash \
    && . ~/.nvm/nvm.sh \
    && nvm install --lts \
    && node -e "console.log('Running Node.js ' + process.version)"

# Add the commands to fix npm permissions
RUN mkdir -p /.npm
RUN chown -R 1002:1002 /.npm


# USER jenkins
USER 1002:1002
